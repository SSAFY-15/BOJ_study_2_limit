version: 2.1

jobs:
  sync-to-study:
    docker:
      - image: cimg/base:stable

    steps:
      - checkout

      - run:
          name: Clone study repository
          command: |
            git clone https://x-access-token:${ORG_PUSH_PAT}@github.com/SSAFY-15/BOJ_study_2_limit.git study-repo

      - run:
          name: Sync BOJ solutions to study repo
          command: |
            export LANG=C.UTF-8

            TARGET_DIR="study-repo/SSAFY-15/BOJ_study_2_limit/백준"
            mkdir -p "$TARGET_DIR"

            rsync -av ./ "$TARGET_DIR" \
              --exclude study-repo \
              --exclude .git \
              --exclude .circleci \
              --exclude README.md

      - run:
          name: Commit & push
          command: |
            cd study-repo

            git config user.name "2_limit"
            git config user.email "tidhtidhdldl@naver.com"

            git add SSAFY-15/BOJ_study_2_limit/백준
            git commit -m "Update 2_limit BOJ solutions" || echo "No changes to commit"

            git push

workflows:
  version: 2
  sync-workflow:
    jobs:
      - sync-to-study
